# 🚧 ScrollView의 드래그 애니메이션이 짧을 때 부자연스러워지는 현상

## 🤔 문제 정의

DayBlock 프로젝트의 메인화면은 캐러셀 레이아웃으로 만들어졌다. 기능상으로는 문제가 없지만, 애니메이션에서 문제가 있는데 바로 휙~휙~ 길게 드래그를 할때는 스크롤 애니메이션이 부드럽게 작동하다가도, 짧게 틱틱 끊으면서 드래그를 할때는 부자연스럽게 뚝뚝 끊기는 현상이 있다. 프로젝트를 진행하면서 꽤나 오랫동안 방치해뒀던 문제지만 언젠가는 해결해야하는 문제이기에 이렇게 정리해본다.

<img width="300" src="(https://github.com/thinkySide/DayBlock/assets/113565086/7ef9a4bb-4eb5-4b69-9704-4bcfef720c1d">

~~~swift
// 캐러셀 애니메이션 핵심 구현 코드 (HomeViewController.swift)

extension HomeViewController: UIScrollViewDelegate {
    
    func scrollViewWillEndDragging(_ scrollView: UIScrollView, withVelocity velocity: CGPoint, targetContentOffset: UnsafeMutablePointer<CGPoint>) {
        
        // 스크롤된 크기 = 스크롤이 멈춘 x좌표 + 스크롤뷰 inset
        let scrollSize = targetContentOffset.pointee.x + scrollView.contentInset.left
        
        // 블럭 크기 = 블럭 가로 사이즈 + 블럭 여백 (보이는 영역 보다 크게 사이즈를 잡아야 캐러셀 구현 가능)
        let blockWidth = Size.blockSize.width + Size.blockSpacing
        
        // 블럭 인덱스 = 스크롤된 크기 / 블럭 크기
        let currentBlockIndex = round(scrollSize / blockWidth)
        
        // 최종 스크롤 위치 지정
        targetContentOffset.pointee = CGPoint(x: currentBlockIndex * blockWidth - scrollView.contentInset.left,
                                              y: scrollView.contentInset.top)
    }
}
~~~

<br>

## 🪓 삽질 기록



<br>

## 💌 Ref.

